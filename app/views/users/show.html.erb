<br />

<div class="row">
  <div class="span3">
  	<h3><%= @user.firstname %> <%= @user.lastname %> </h3>
  	<% if (not @user == current_user) and (not @friend) %>
	  	<%= link_to "Add Friend", friendships_path(:friend_id => @user), :method => :post %>
	 <% end %>
  	<br />
  	<%= link_to "View Friends", friends_path(@user) %>
	<br />
  	<br />
  </div>  
  <div id="item_show"></div>
</div>

<% if @followedlists %>
	<ul class="nav nav-tabs">
		<li>
			<%= link_to "#{@user.firstname}'s Lists", user_path(@user) %>
		</li>
		<li class="active">
			<a href="#">Followed Lists</a>
		</li>
	</ul>
<% elsif @search %>
	<ul class="nav nav-tabs">
		<li>
			<%= link_to "#{@user.firstname}'s Lists", user_path(@user) %>
		</li>
		<li>
			<%= link_to "Followed Lists", user_path(id:@user.id, followedlists: true) %>
		</li>
		<li class="active">
			<a href="#">Search Results</a>
		</li>
	</ul>
<% else %>
	<ul class="nav nav-tabs">
		<li class="active">
			<a href="#"><%= "#{@user.firstname}'s Lists" %></a>
		</li>
		<li>
			<%= link_to "Followed Lists", user_path(id:@user.id, followedlists: true) %>
		</li>
	</ul>	

	<% if @user == current_user %>
		<!-- Modal -->
		<div class="modal hide fade" id="listModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-header">
		    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		    <h3 id="myModalLabel">Pick a general title.</h3>
		  </div>
			<%= form_for(List.new, remote: true, :html => { :class => "modal-form" }) do |f| %>
				<%= f.hidden_field :user_id, :value => @user.id %>
				<div class="modal-body field">
					<%= f.label :title, "List title:" %>
					<%= f.text_field :title, placeholder: "" %>
					<p style="font-size:x-small; margin-top:-1em">Eg. Books, Movies, Restaurants, Destinations, Music, Doctors, Shoes...</p>
					<%= f.label :privacy, "Privacy for list:" %>
					<%= f.select :privacy, [['public', 0], ['friends only', 1], ['private', 2]], :selected => 1 %>
					<a href="#" rel="tooltip" title="Your list can be public, visible to your friends only, or private. Friends of your friends can see it only if it is public."><i class="icon-question-sign"></i></a>
				</div>
				<div class="modal-footer">
					<%= f.submit "Add List", :class => "btn btn-primary" %>
				</div>
     		<% end %>
		</div>
	<% end %>

	<% if @user == current_user %>
		<!-- Button to trigger modal -->
		<a href="#" role="button" class="btn btn-mini btn-primary" data-toggle="modal" id="listModalButton" style="margin-bottom:4px">+ list</a>
	<% end %>

 <% end %>

 	<% if @search %>
 		Searched your list and your friends: <strong><%= @lists.count %> <%= "list".pluralize(@lists.count) %> returned for <%= @search %></strong>
 	<% end %>

 	<% if @tag %>
 		Filtered by: <strong><%= @tag %></strong> <%= link_to "x", user_path(@user) %>
 	<% else %>

 	<% end %>

 	<% if not @tagcounts.empty? %>
		<div id="tag_cloud">
		  Tags: 
		  <% tag_cloud @tagcounts, %w[s m l] do |tag, css_class| %>
		    <%= link_to tag.name.downcase, tag_path(id:@user.id, tag:tag.name, search:@search, followedlists:@followedlists), class: css_class %>
		  <% end %>
		  <br />
		</div>
	<% else %>
		<br />
	<% end %>


	<hr>


<% if @user == current_user %>
				<!-- Modal -->
				<div class="modal hide fade" id="itemModal" tabindex="-1" role="dialog" aria-labelledby="itemModalLabel" aria-hidden="true">
				  <div class="modal-header">
				    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				    <h3 id="itemModalLabel"></h3>
				  </div>
					<%= form_for(Item.new, remote: true, :html => { :class => "modal-form"}) do |f| %>
						<%= f.hidden_field :list_id, :value => 1 %>
						<div class="modal-body field">
							<div class="field" id="location">
								<%= f.label :location, "If it's a place, enter a location:" %>
								<%= f.text_field :location, placeholder: "city, neighborhood, or zipcode", :style => "font-size:1em" %>
							</div>
							<br />
							<div class="ui-widget">
								<%= f.text_field :name, placeholder: "Enter item here", :style => "width:400px;height:40px;margin-left:60px;font-size:1.5em" %>
								<%= f.text_field :category, placeholder: "Enter category for item", :style => "width:400px;height:28px;margin-left:60px;font-size:1em" %>
								<%= f.text_area :initial_comment, placeholder: "Write what you think about this item...", :style => "width:400px;height:60px;margin-left:60px;font-size:1em" %>
							</div>					
						</div>
						<div class="modal-footer">
							<%= f.submit "Add Another", :id => "submit_item_another", :class => "btn btn-primary", :type => "button" %>
							<%= f.submit "Done", :id => "submit_item", :class => "btn btn-primary" %>
						</div>
					<% end %>
				</div>
			<% end %>

<div id="lists">
<% for i in 0..(@lists.count-1)/5 %>
	<div class="row" style="margin-left:0px; border-bottom-width:1px; border-bottom-color:#eee; border-bottom-style:solid;">
		<% @max_items = 0 %>
		<% @lists[5*i..(5*(i+1)-1)].each do |l| %>
			<% if l.items.count > @max_items %>
				<% @max_items = l.items.count %>
			<% end%>
		<% end %>
		<%= render @lists[5*i..(5*(i+1)-1)] %>
	</div>
<% end %>
</div>